this is my current codebase for a web implementation of a python site. in my next message I'll show you the code for the original python site. Weather Site Directory Report
Generated on: 2025-01-04 23:11:07
==================================================

üìÅ weather_site/
  üìÑ .DS_Store (6148 bytes)
     Modified: 2025-01-04 21:48:50
  üìÑ db.sqlite3 (39428096 bytes)
     Modified: 2025-01-04 23:07:20
     Database content:
     
Database: db.sqlite3
==================================================

Table: django_migrations
Columns: id, app, name, applied

Sample rows:
(1, 'contenttypes', '0001_initial', '2025-01-04 23:02:56.013512')
(2, 'auth', '0001_initial', '2025-01-04 23:02:56.018680')
(3, 'admin', '0001_initial', '2025-01-04 23:02:56.021874')
(4, 'admin', '0002_logentry_remove_auto_add', '2025-01-04 23:02:56.026060')
(5, 'admin', '0003_logentry_add_action_flag_choices', '2025-01-04 23:02:56.028975')

Table: sqlite_sequence
Columns: name, seq

Sample rows:
('django_migrations', 20)
('django_admin_log', 0)
('django_content_type', 8)
('auth_permission', 32)
('auth_group', 0)

Table: auth_group_permissions
Columns: id, group_id, permission_id

Sample rows:

Table: auth_user_groups
Columns: id, user_id, group_id

Sample rows:

Table: auth_user_user_permissions
Columns: id, user_id, permission_id

Sample rows:

Table: django_admin_log
Columns: id, object_id, object_repr, action_flag, change_message, content_type_id, user_id, action_time

Sample rows:

Table: django_content_type
Columns: id, app_label, model

Sample rows:
(1, 'admin', 'logentry')
(2, 'auth', 'permission')
(3, 'auth', 'group')
(4, 'auth', 'user')
(5, 'contenttypes', 'contenttype')

Table: auth_permission
Columns: id, content_type_id, codename, name

Sample rows:
(1, 1, 'add_logentry', 'Can add log entry')
(2, 1, 'change_logentry', 'Can change log entry')
(3, 1, 'delete_logentry', 'Can delete log entry')
(4, 1, 'view_logentry', 'Can view log entry')
(5, 2, 'add_permission', 'Can add permission')

Table: auth_group
Columns: id, name

Sample rows:

Table: auth_user
Columns: id, password, last_login, is_superuser, username, last_name, email, is_staff, is_active, date_joined, first_name

Sample rows:
(1, 'pbkdf2_sha256$870000$sIVLdb8J0DF4EAqO3y2DsC$cghjP9c9dEDzwYuOpvFbFVRG6OikyWlotKrQ+j469qY=', None, 1, 'jdc', '', 'josdiazcontreras@gmail.com', 1, 1, '2025-01-05 02:59:02.810174', '')

Table: django_session
Columns: session_key, session_data, expire_date

Sample rows:

Table: weather_app_city
Columns: id, name, country, latitude, longitude

Sample rows:
(738024, 'Honolulu', 'USA', 21.3069, -157.8583)
(738025, 'Todos Santos', 'Mexico', 0.0, 0.0)
(738026, 'Tenerife', 'Spain', 0.0, 0.0)
(738027, 'Los Angeles', 'USA', 34.0522, -118.2437)
(738028, 'Medellin', 'Colombia', 0.0, 0.0)

Table: weather_app_dailydata
Columns: id, date, tmax_c, tmin_c, weathercode, sunrise, city_id, sunset

Sample rows:
(41531, '2024-12-17', 27.2, 27.2, 0, '2024-12-17 17:03:00', 738024, '2024-12-18 03:53:00')
(41532, '2024-12-16', 29.0, 20.5, 2, '2024-12-16 17:02:00', 738024, '2024-12-17 03:52:00')
(41533, '2024-12-15', 27.5, 22.3, 3, '2024-12-15 17:01:00', 738024, '2024-12-16 03:52:00')
(41534, '2024-12-14', 27.6, 23.0, 3, '2024-12-14 17:01:00', 738024, '2024-12-15 03:51:00')
(41535, '2024-12-13', 27.6, 23.9, 3, '2024-12-13 17:00:00', 738024, '2024-12-14 03:51:00')
  üìÑ weather_data.db (150601728 bytes)
     Modified: 2024-12-21 01:54:42
     Database content:
     
Database: weather_data.db
==================================================

Table: daily_data
Columns: city, date, tmax_c, tmin_c, weathercode, sunrise, sunset, sunshine_duration_sec

Sample rows:
('Honolulu', '2022-01-01', 23.5, 20.9, 63, '2022-01-01T17:09:00', '2022-01-02T04:01:00', None)
('Honolulu', '2022-01-02', 22.6, 21.2, 63, '2022-01-02T17:09:00', '2022-01-03T04:01:00', None)
('Honolulu', '2022-01-03', 23.9, 19.7, 61, '2022-01-03T17:09:00', '2022-01-04T04:02:00', None)
('Honolulu', '2022-01-04', 24.0, 20.6, 53, '2022-01-04T17:10:00', '2022-01-05T04:03:00', None)
('Honolulu', '2022-01-05', 25.3, 20.4, 53, '2022-01-05T17:10:00', '2022-01-06T04:03:00', None)

Table: forecast_cache
Columns: city, data, updated_at

Sample rows:
('Honolulu', '{"fore_json": {"latitude": 21.375, "longitude": -158.0, "generationtime_ms": 0.12195110321044922, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 4.0, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [45, 45, 3, 2, 2, 3, 2, 3, 3, 3, 2, 51, 51, 51, 2, 2], "sunrise": ["2024-12-18T17:04", "2024-12-19T17:04", "2024-12-20T17:05", "2024-12-21T17:05", "2024-12-22T17:06", "2024-12-23T17:06", "2024-12-24T17:06", "2024-12-25T17:07", "2024-12-26T17:07", "2024-12-27T17:08", "2024-12-28T17:08", "2024-12-29T17:09", "2024-12-30T17:09", "2024-12-31T17:09", "2025-01-01T17:10", "2025-01-02T17:10"], "sunset": ["2024-12-19T03:53", "2024-12-20T03:54", "2024-12-21T03:54", "2024-12-22T03:55", "2024-12-23T03:55", "2024-12-24T03:56", "2024-12-25T03:56", "2024-12-26T03:57", "2024-12-27T03:58", "2024-12-28T03:58", "2024-12-29T03:59", "2024-12-30T03:59", "2024-12-31T04:00", "2025-01-01T04:01", "2025-01-02T04:01", "2025-01-03T04:02"], "temperature_2m_max": [27.7, 29.8, 29.8, 28.8, 27.6, 28.0, 28.5, 28.3, 25.6, 25.2, 24.6, 24.6, 24.6, 24.5, 24.5, 24.2], "temperature_2m_min": [22.0, 21.0, 23.0, 22.0, 21.7, 23.6, 23.4, 21.1, 22.4, 23.0, 23.0, 23.0, 22.6, 23.0, 22.8, 22.9]}}, "cur_json": {"latitude": 21.375, "longitude": -158.0, "generationtime_ms": 0.12111663818359375, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 4.0, "current_weather_units": {"time": "iso8601", "interval": "seconds", "temperature": "\\u00b0C", "windspeed": "km/h", "winddirection": "\\u00b0", "is_day": "", "weathercode": "wmo code"}, "current_weather": {"time": "2024-12-18T07:15", "interval": 900, "temperature": 24.4, "windspeed": 2.3, "winddirection": 162, "is_day": 0, "weathercode": 0}, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [45, 45, 3, 2, 2, 3, 2, 3, 3, 3, 2, 51, 51, 51, 2, 2], "sunrise": ["2024-12-18T17:04", "2024-12-19T17:04", "2024-12-20T17:05", "2024-12-21T17:05", "2024-12-22T17:06", "2024-12-23T17:06", "2024-12-24T17:06", "2024-12-25T17:07", "2024-12-26T17:07", "2024-12-27T17:08", "2024-12-28T17:08", "2024-12-29T17:09", "2024-12-30T17:09", "2024-12-31T17:09", "2025-01-01T17:10", "2025-01-02T17:10"], "sunset": ["2024-12-19T03:53", "2024-12-20T03:54", "2024-12-21T03:54", "2024-12-22T03:55", "2024-12-23T03:55", "2024-12-24T03:56", "2024-12-25T03:56", "2024-12-26T03:57", "2024-12-27T03:58", "2024-12-28T03:58", "2024-12-29T03:59", "2024-12-30T03:59", "2024-12-31T04:00", "2025-01-01T04:01", "2025-01-02T04:01", "2025-01-03T04:02"], "temperature_2m_max": [27.7, 29.8, 29.8, 28.8, 27.6, 28.0, 28.5, 28.3, 25.6, 25.2, 24.6, 24.6, 24.6, 24.5, 24.5, 24.2], "temperature_2m_min": [22.0, 21.0, 23.0, 22.0, 21.7, 23.6, 23.4, 21.1, 22.4, 23.0, 23.0, 23.0, 22.6, 23.0, 22.8, 22.9]}}}', '2024-12-18T07:25:03.827088+00:00')
('Todos Santos', '{"fore_json": {"latitude": 23.625, "longitude": -110.375, "generationtime_ms": 0.08404254913330078, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 34.0, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [1, 0, 0, 0, 3, 2, 3, 0, 3, 3, 3, 0, 3, 3, 3, 3], "sunrise": ["2024-12-18T13:58", "2024-12-19T13:58", "2024-12-20T13:59", "2024-12-21T13:59", "2024-12-22T14:00", "2024-12-23T14:00", "2024-12-24T14:00", "2024-12-25T14:01", "2024-12-26T14:01", "2024-12-27T14:02", "2024-12-28T14:02", "2024-12-29T14:02", "2024-12-30T14:03", "2024-12-31T14:03", "2025-01-01T14:03", "2025-01-02T14:04"], "sunset": ["2024-12-19T00:38", "2024-12-20T00:39", "2024-12-21T00:39", "2024-12-22T00:40", "2024-12-23T00:40", "2024-12-24T00:41", "2024-12-25T00:41", "2024-12-26T00:42", "2024-12-27T00:42", "2024-12-28T00:43", "2024-12-29T00:44", "2024-12-30T00:44", "2024-12-31T00:45", "2025-01-01T00:46", "2025-01-02T00:46", "2025-01-03T00:47"], "temperature_2m_max": [28.8, 29.1, 31.0, 31.9, 28.3, 22.6, 22.4, 24.9, 23.9, 23.5, 25.3, 26.0, 26.0, 28.5, 25.0, 23.3], "temperature_2m_min": [12.2, 12.6, 12.8, 14.8, 13.5, 13.2, 12.1, 12.4, 13.4, 13.7, 13.5, 14.7, 15.1, 16.9, 16.3, 12.5]}}, "cur_json": {"latitude": 23.625, "longitude": -110.375, "generationtime_ms": 0.16701221466064453, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 34.0, "current_weather_units": {"time": "iso8601", "interval": "seconds", "temperature": "\\u00b0C", "windspeed": "km/h", "winddirection": "\\u00b0", "is_day": "", "weathercode": "wmo code"}, "current_weather": {"time": "2024-12-18T07:15", "interval": 900, "temperature": 15.2, "windspeed": 9.0, "winddirection": 29, "is_day": 0, "weathercode": 0}, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [1, 0, 0, 0, 3, 2, 3, 0, 3, 3, 3, 0, 3, 3, 3, 3], "sunrise": ["2024-12-18T13:58", "2024-12-19T13:58", "2024-12-20T13:59", "2024-12-21T13:59", "2024-12-22T14:00", "2024-12-23T14:00", "2024-12-24T14:00", "2024-12-25T14:01", "2024-12-26T14:01", "2024-12-27T14:02", "2024-12-28T14:02", "2024-12-29T14:02", "2024-12-30T14:03", "2024-12-31T14:03", "2025-01-01T14:03", "2025-01-02T14:04"], "sunset": ["2024-12-19T00:38", "2024-12-20T00:39", "2024-12-21T00:39", "2024-12-22T00:40", "2024-12-23T00:40", "2024-12-24T00:41", "2024-12-25T00:41", "2024-12-26T00:42", "2024-12-27T00:42", "2024-12-28T00:43", "2024-12-29T00:44", "2024-12-30T00:44", "2024-12-31T00:45", "2025-01-01T00:46", "2025-01-02T00:46", "2025-01-03T00:47"], "temperature_2m_max": [28.8, 29.1, 31.0, 31.9, 28.3, 22.6, 22.4, 24.9, 23.9, 23.5, 25.3, 26.0, 26.0, 28.5, 25.0, 23.3], "temperature_2m_min": [12.2, 12.6, 12.8, 14.8, 13.5, 13.2, 12.1, 12.4, 13.4, 13.7, 13.5, 14.7, 15.1, 16.9, 16.3, 12.5]}}}', '2024-12-18T07:25:04.775160+00:00')
('Tenerife', '{"fore_json": {"latitude": 28.2, "longitude": -16.599998, "generationtime_ms": 0.1850128173828125, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 2502.0, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [1, 3, 3, 3, 80, 2, 3, 3, 3, 3, 3, 3, 51, 2, 1, 2], "sunrise": ["2024-12-18T07:52", "2024-12-19T07:53", "2024-12-20T07:53", "2024-12-21T07:54", "2024-12-22T07:54", "2024-12-23T07:55", "2024-12-24T07:55", "2024-12-25T07:55", "2024-12-26T07:56", "2024-12-27T07:56", "2024-12-28T07:57", "2024-12-29T07:57", "2024-12-30T07:57", "2024-12-31T07:58", "2025-01-01T07:58", "2025-01-02T07:58"], "sunset": ["2024-12-18T18:13", "2024-12-19T18:14", "2024-12-20T18:14", "2024-12-21T18:15", "2024-12-22T18:15", "2024-12-23T18:16", "2024-12-24T18:16", "2024-12-25T18:17", "2024-12-26T18:17", "2024-12-27T18:18", "2024-12-28T18:19", "2024-12-29T18:19", "2024-12-30T18:20", "2024-12-31T18:21", "2025-01-01T18:21", "2025-01-02T18:22"], "temperature_2m_max": [13.2, 12.8, 11.9, 5.9, 3.3, 6.2, 8.0, 8.1, 9.1, 10.6, 8.8, 6.9, 5.7, 6.7, 7.1, 8.2], "temperature_2m_min": [5.3, 4.2, 4.4, -1.0, -1.9, 1.8, 2.9, 3.4, 2.3, 5.7, 5.4, 2.6, 1.2, 0.8, 0.2, 0.3]}}, "cur_json": {"latitude": 28.2, "longitude": -16.599998, "generationtime_ms": 0.15997886657714844, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 2502.0, "current_weather_units": {"time": "iso8601", "interval": "seconds", "temperature": "\\u00b0C", "windspeed": "km/h", "winddirection": "\\u00b0", "is_day": "", "weathercode": "wmo code"}, "current_weather": {"time": "2024-12-18T07:15", "interval": 900, "temperature": 6.2, "windspeed": 11.8, "winddirection": 38, "is_day": 0, "weathercode": 1}, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [1, 3, 3, 3, 80, 2, 3, 3, 3, 3, 3, 3, 51, 2, 1, 2], "sunrise": ["2024-12-18T07:52", "2024-12-19T07:53", "2024-12-20T07:53", "2024-12-21T07:54", "2024-12-22T07:54", "2024-12-23T07:55", "2024-12-24T07:55", "2024-12-25T07:55", "2024-12-26T07:56", "2024-12-27T07:56", "2024-12-28T07:57", "2024-12-29T07:57", "2024-12-30T07:57", "2024-12-31T07:58", "2025-01-01T07:58", "2025-01-02T07:58"], "sunset": ["2024-12-18T18:13", "2024-12-19T18:14", "2024-12-20T18:14", "2024-12-21T18:15", "2024-12-22T18:15", "2024-12-23T18:16", "2024-12-24T18:16", "2024-12-25T18:17", "2024-12-26T18:17", "2024-12-27T18:18", "2024-12-28T18:19", "2024-12-29T18:19", "2024-12-30T18:20", "2024-12-31T18:21", "2025-01-01T18:21", "2025-01-02T18:22"], "temperature_2m_max": [13.2, 12.8, 11.9, 5.9, 3.3, 6.2, 8.0, 8.1, 9.1, 10.6, 8.8, 6.9, 5.7, 6.7, 7.1, 8.2], "temperature_2m_min": [5.3, 4.2, 4.4, -1.0, -1.9, 1.8, 2.9, 3.4, 2.3, 5.7, 5.4, 2.6, 1.2, 0.8, 0.2, 0.3]}}}', '2024-12-18T07:25:05.803405+00:00')
('Los Angeles', '{"fore_json": {"latitude": 34.060257, "longitude": -118.23433, "generationtime_ms": 0.2810955047607422, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 91.0, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [0, 45, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 53, 3, 3, 3], "sunrise": ["2024-12-18T14:53", "2024-12-19T14:53", "2024-12-20T14:54", "2024-12-21T14:54", "2024-12-22T14:55", "2024-12-23T14:55", "2024-12-24T14:56", "2024-12-25T14:56", "2024-12-26T14:57", "2024-12-27T14:57", "2024-12-28T14:57", "2024-12-29T14:57", "2024-12-30T14:58", "2024-12-31T14:58", "2025-01-01T14:58", "2025-01-02T14:58"], "sunset": ["2024-12-19T00:46", "2024-12-20T00:46", "2024-12-21T00:47", "2024-12-22T00:47", "2024-12-23T00:48", "2024-12-24T00:48", "2024-12-25T00:49", "2024-12-26T00:50", "2024-12-27T00:50", "2024-12-28T00:51", "2024-12-29T00:52", "2024-12-30T00:52", "2024-12-31T00:53", "2025-01-01T00:54", "2025-01-02T00:54", "2025-01-03T00:55"], "temperature_2m_max": [29.2, 25.6, 22.5, 21.2, 18.8, 20.7, 19.8, 18.9, 18.0, 17.1, 19.4, 19.5, 17.1, 16.9, 16.3, 14.0], "temperature_2m_min": [13.2, 8.3, 16.7, 14.7, 14.3, 14.0, 15.1, 12.9, 13.7, 12.5, 12.1, 13.6, 11.9, 10.7, 10.8, 10.0]}}, "cur_json": {"latitude": 34.060257, "longitude": -118.23433, "generationtime_ms": 0.20301342010498047, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 91.0, "current_weather_units": {"time": "iso8601", "interval": "seconds", "temperature": "\\u00b0C", "windspeed": "km/h", "winddirection": "\\u00b0", "is_day": "", "weathercode": "wmo code"}, "current_weather": {"time": "2024-12-18T07:15", "interval": 900, "temperature": 17.1, "windspeed": 6.5, "winddirection": 357, "is_day": 0, "weathercode": 0}, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [0, 45, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 53, 3, 3, 3], "sunrise": ["2024-12-18T14:53", "2024-12-19T14:53", "2024-12-20T14:54", "2024-12-21T14:54", "2024-12-22T14:55", "2024-12-23T14:55", "2024-12-24T14:56", "2024-12-25T14:56", "2024-12-26T14:57", "2024-12-27T14:57", "2024-12-28T14:57", "2024-12-29T14:57", "2024-12-30T14:58", "2024-12-31T14:58", "2025-01-01T14:58", "2025-01-02T14:58"], "sunset": ["2024-12-19T00:46", "2024-12-20T00:46", "2024-12-21T00:47", "2024-12-22T00:47", "2024-12-23T00:48", "2024-12-24T00:48", "2024-12-25T00:49", "2024-12-26T00:50", "2024-12-27T00:50", "2024-12-28T00:51", "2024-12-29T00:52", "2024-12-30T00:52", "2024-12-31T00:53", "2025-01-01T00:54", "2025-01-02T00:54", "2025-01-03T00:55"], "temperature_2m_max": [29.2, 25.6, 22.5, 21.2, 18.8, 20.7, 19.8, 18.9, 18.0, 17.1, 19.4, 19.5, 17.1, 16.9, 16.3, 14.0], "temperature_2m_min": [13.2, 8.3, 16.7, 14.7, 14.3, 14.0, 15.1, 12.9, 13.7, 12.5, 12.1, 13.6, 11.9, 10.7, 10.8, 10.0]}}}', '2024-12-18T07:25:06.813957+00:00')
('Medellin', '{"fore_json": {"latitude": 6.125, "longitude": -75.75, "generationtime_ms": 0.09799003601074219, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 1476.0, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [80, 80, 95, 96, 96, 95, 95, 95, 80, 53, 51, 53, 53, 51, 51, 51], "sunrise": ["2024-12-18T11:06", "2024-12-19T11:07", "2024-12-20T11:07", "2024-12-21T11:08", "2024-12-22T11:08", "2024-12-23T11:09", "2024-12-24T11:09", "2024-12-25T11:10", "2024-12-26T11:10", "2024-12-27T11:11", "2024-12-28T11:11", "2024-12-29T11:12", "2024-12-30T11:12", "2024-12-31T11:13", "2025-01-01T11:13", "2025-01-02T11:14"], "sunset": ["2024-12-18T22:52", "2024-12-19T22:53", "2024-12-20T22:53", "2024-12-21T22:54", "2024-12-22T22:54", "2024-12-23T22:55", "2024-12-24T22:55", "2024-12-25T22:56", "2024-12-26T22:56", "2024-12-27T22:57", "2024-12-28T22:57", "2024-12-29T22:58", "2024-12-30T22:59", "2024-12-31T22:59", "2025-01-01T23:00", "2025-01-02T23:00"], "temperature_2m_max": [26.2, 26.2, 26.3, 25.0, 24.9, 24.5, 24.0, 24.8, 21.4, 20.9, 22.3, 24.8, 22.2, 24.3, 25.2, 23.8], "temperature_2m_min": [18.7, 18.7, 18.5, 18.5, 18.1, 18.5, 18.7, 18.3, 16.4, 16.7, 14.7, 15.6, 16.1, 15.5, 14.8, 15.2]}}, "cur_json": {"latitude": 6.125, "longitude": -75.75, "generationtime_ms": 0.20706653594970703, "utc_offset_seconds": 0, "timezone": "UTC", "timezone_abbreviation": "UTC", "elevation": 1476.0, "current_weather_units": {"time": "iso8601", "interval": "seconds", "temperature": "\\u00b0C", "windspeed": "km/h", "winddirection": "\\u00b0", "is_day": "", "weathercode": "wmo code"}, "current_weather": {"time": "2024-12-18T07:15", "interval": 900, "temperature": 19.5, "windspeed": 3.9, "winddirection": 68, "is_day": 0, "weathercode": 3}, "daily_units": {"time": "iso8601", "weathercode": "wmo code", "sunrise": "iso8601", "sunset": "iso8601", "temperature_2m_max": "\\u00b0C", "temperature_2m_min": "\\u00b0C"}, "daily": {"time": ["2024-12-18", "2024-12-19", "2024-12-20", "2024-12-21", "2024-12-22", "2024-12-23", "2024-12-24", "2024-12-25", "2024-12-26", "2024-12-27", "2024-12-28", "2024-12-29", "2024-12-30", "2024-12-31", "2025-01-01", "2025-01-02"], "weathercode": [80, 80, 95, 96, 96, 95, 95, 95, 80, 53, 51, 53, 53, 51, 51, 51], "sunrise": ["2024-12-18T11:06", "2024-12-19T11:07", "2024-12-20T11:07", "2024-12-21T11:08", "2024-12-22T11:08", "2024-12-23T11:09", "2024-12-24T11:09", "2024-12-25T11:10", "2024-12-26T11:10", "2024-12-27T11:11", "2024-12-28T11:11", "2024-12-29T11:12", "2024-12-30T11:12", "2024-12-31T11:13", "2025-01-01T11:13", "2025-01-02T11:14"], "sunset": ["2024-12-18T22:52", "2024-12-19T22:53", "2024-12-20T22:53", "2024-12-21T22:54", "2024-12-22T22:54", "2024-12-23T22:55", "2024-12-24T22:55", "2024-12-25T22:56", "2024-12-26T22:56", "2024-12-27T22:57", "2024-12-28T22:57", "2024-12-29T22:58", "2024-12-30T22:59", "2024-12-31T22:59", "2025-01-01T23:00", "2025-01-02T23:00"], "temperature_2m_max": [26.2, 26.2, 26.3, 25.0, 24.9, 24.5, 24.0, 24.8, 21.4, 20.9, 22.3, 24.8, 22.2, 24.3, 25.2, 23.8], "temperature_2m_min": [18.7, 18.7, 18.5, 18.5, 18.1, 18.5, 18.7, 18.3, 16.4, 16.7, 14.7, 15.6, 16.1, 15.5, 14.8, 15.2]}}}', '2024-12-18T07:25:07.872518+00:00')

Table: city_coords
Columns: city, lat, lon

Sample rows:
('Canillo, AD', 42.5833, 1.6667)
('Encamp, AD', 42.5333, 1.6333)
('La Massana, AD', 42.5667, 1.4833)
('Ordino, AD', 42.6, 1.55)
('Sant Juli√† de L√≤ria, AD', 42.4667, 1.5)

Table: monthly_agg
Columns: city, month, avg_day_f, sunny_day, day_length_hrs, niceness

Sample rows:
('Aalborg, Denmark', 1, 38.51483870967742, 1.0, 7.512096774193548, 0.08658434139784946)
('Aalborg, Denmark', 2, 39.07785714285714, 0.0, 9.495238095238095, 0.09890873015873015)
('Aalborg, Denmark', 3, 37.85435483870968, 8.0, 11.854032258064517, 0.19014616935483872)
('Aalborg, Denmark', 4, 44.135, 6.0, 14.311666666666667, 0.19907986111111114)
('Aalborg, Denmark', 5, 52.63032258064516, 4.0, 16.531720430107526, 0.3100821012544802)
  üìÑ manage.py (668 bytes)
     Modified: 2025-01-04 17:42:24
     Content:
     ====================
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "weather_site.settings")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == "__main__":
    main()

     ====================
  üìÅ weather_site/
    üìÑ .DS_Store (6148 bytes)
       Modified: 2025-01-04 17:45:51
    üìÑ asgi.py (401 bytes)
       Modified: 2025-01-04 17:42:24
       Content:
       ====================
"""
ASGI config for weather_site project.

It exposes the ASGI callable as a module-level variable named `application.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "weather_site.settings")

application = get_asgi_application()

       ====================
    üìÑ __init__.py (0 bytes)
       Modified: 2025-01-04 17:42:24
       Content:
       ====================

       ====================
    üìÑ settings.py (3280 bytes)
       Modified: 2025-01-04 19:30:17
       Content:
       ====================
"""
Django settings for weather_site project.

Generated by 'django-admin startproject' using Django 5.1.4.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.1/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.1/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = "django-insecure-u4j#v9w!#d=#$nj*v#kot95jpcjl($x#9o$qm*!i(e=s^qqet1"

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "rest_framework",
    "weather_app",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

ROOT_URLCONF = "weather_site.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "weather_site.wsgi.application"


# Database
# https://docs.djangoproject.com/en/5.1/ref/settings/#databases

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.1/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
    },
    {
        "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.1/topics/i18n/

LANGUAGE_CODE = "en-us"

TIME_ZONE = "UTC"

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.1/howto/static-files/

STATIC_URL = "static/"

# Default primary key field type
# https://docs.djangoproject.com/en/5.1/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"

       ====================
    üìÑ urls.py (954 bytes)
       Modified: 2025-01-04 21:56:13
       Content:
       ====================
"""
URL configuration for weather_site project.

The urlpatterns list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.1/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""

from django.contrib import admin
from django.urls import path, include
from weather_app.urls import api_patterns

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('weather_app.urls')),  # For serving the home page
    path('api/', include(api_patterns)),  # For API endpoints
]

       ====================
    üìÑ wsgi.py (401 bytes)
       Modified: 2025-01-04 17:42:24
       Content:
       ====================
"""
WSGI config for weather_site project.

It exposes the WSGI callable as a module-level variable named `application.

For more information on this file, see
https://docs.djangoproject.com/en/5.1/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "weather_site.settings")

application = get_wsgi_application()

       ====================
    üìÅ __pycache__/
      üìÑ settings.cpython-311.pyc (2655 bytes)
         Modified: 2025-01-04 19:30:18
      üìÑ urls.cpython-311.pyc (1321 bytes)
         Modified: 2025-01-04 21:56:19
      üìÑ wsgi.cpython-311.pyc (715 bytes)
         Modified: 2025-01-04 17:46:26
      üìÑ __init__.cpython-311.pyc (183 bytes)
         Modified: 2025-01-04 17:42:46
  üìÅ weather_app/
    üìÑ .DS_Store (6148 bytes)
       Modified: 2025-01-04 21:09:43
    üìÑ models.py (674 bytes)
       Modified: 2025-01-04 23:06:17
       Content:
       ====================
from django.db import models

class City(models.Model):
    name = models.CharField(max_length=100)
    country = models.CharField(max_length=100, blank=True)
    latitude = models.FloatField()
    longitude = models.FloatField()

    def __str__(self):
        return self.name

class DailyData(models.Model):
    city = models.ForeignKey(City, on_delete=models.CASCADE, related_name='daily_data')
    date = models.DateField()
    tmax_c = models.FloatField()
    tmin_c = models.FloatField()
    weathercode = models.IntegerField()
    sunrise = models.TimeField()
    sunset = models.TimeField()

    def __str__(self):
        return f"{self.city.name} on {self.date}"

       ====================
    üìÑ serializers.py (534 bytes)
       Modified: 2025-01-04 19:28:44
       Content:
       ====================
from rest_framework import serializers
from .models import City, DailyData

class CitySerializer(serializers.ModelSerializer):
    class Meta:
        model = City
        fields = '__all__'
        # or list fields explicitly, e.g.
        # fields = ['id', 'name', 'country', 'latitude', 'longitude']

class DailyDataSerializer(serializers.ModelSerializer):
    class Meta:
        model = DailyData
        fields = '__all__'
        # or a subset like:
        # fields = ['id', 'city', 'date', 'tmax_c', 'tmin_c', 'weathercode'] 
       ====================
    üìÑ __init__.py (0 bytes)
       Modified: 2025-01-04 17:42:46
       Content:
       ====================

       ====================
    üìÑ apps.py (969 bytes)
       Modified: 2025-01-04 23:03:06
       Content:
       ====================
from django.apps import AppConfig
import threading
import time
from datetime import datetime
import subprocess
import os


class WeatherAppConfig(AppConfig):
    default_auto_field = "django.db.models.BigAutoField"
    name = "weather_app"

    def ready(self):
        # Avoid running this in manage.py commands
        if os.environ.get('RUN_MAIN'):
            self.start_weather_updater()

    def start_weather_updater(self):
        def update_weather():
            while True:
                try:
                    # Run the management command
                    subprocess.run(['python', 'manage.py', 'fetch_weather'])
                except Exception as e:
                    print(f"Error updating weather: {e}")
                
                # Sleep for 24 hours
                time.sleep(24 * 60 * 60)

        # Start the updater in a background thread
        thread = threading.Thread(target=update_weather, daemon=True)
        thread.start()

       ====================
    üìÑ admin.py (63 bytes)
       Modified: 2025-01-04 17:42:46
       Content:
       ====================
from django.contrib import admin

# Register your models here.

       ====================
    üìÑ tests.py (60 bytes)
       Modified: 2025-01-04 17:42:46
       Content:
       ====================
from django.test import TestCase

# Create your tests here.

       ====================
    üìÑ urls.py (580 bytes)
       Modified: 2025-01-04 22:06:06
       Content:
       ====================
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import CityViewSet, DailyDataViewSet, home_page, current_weather

router = DefaultRouter()
router.register(r'cities', CityViewSet, basename='city')
router.register(r'dailydata', DailyDataViewSet, basename='dailydata')

# Main URL patterns (only for non-API routes)
urlpatterns = [
    path('', home_page, name='home'),  # serve index.html at root
]

# API routes
api_patterns = [
    path('', include(router.urls)),
    path('current/', current_weather, name='current_weather'),
] 
       ====================
    üìÑ views.py (3896 bytes)
       Modified: 2025-01-04 23:07:52
       Content:
       ====================
from django.shortcuts import render
from django.http import HttpResponse
from rest_framework import viewsets
from .models import City, DailyData
from .serializers import CitySerializer, DailyDataSerializer
from rest_framework.decorators import api_view
from rest_framework.response import Response
from datetime import datetime, timedelta
from django.http import JsonResponse
from django.db.models import Avg, Max, Min, Count, Q

# Create your views here.

def home_page(request):
    return render(request, 'index.html')

def hello_weather(request):
    return HttpResponse("Hello from the new Weather App!")

class CityViewSet(viewsets.ModelViewSet):
    queryset = City.objects.all()
    serializer_class = CitySerializer

class DailyDataViewSet(viewsets.ModelViewSet):
    queryset = DailyData.objects.all()
    serializer_class = DailyDataSerializer

def celsius_to_fahrenheit(c):
    return (c * 9/5) + 32

def calculate_niceness(avg_temp_f, sunny_days_16, day_length):
    # Temperature component (0-0.5 points)
    # Ideal temperature range is 65-80¬∞F
    if 65 <= avg_temp_f <= 80:
        temp_score = 0.5
    else:
        temp_score = max(0.0, 0.5 - abs(avg_temp_f - 72.5) / 100.0)
    
    # Sunny days component (0-0.3 points)
    # Scale based on number of sunny days in the past 16 days
    sun_score = (sunny_days_16 / 16.0) * 0.3
    
    # Day length component (0-0.2 points)
    # Ideal day length is 12+ hours
    day_length_score = min(0.2, max(0.0, (day_length - 8.0) / 20.0))
    
    return round(temp_score + sun_score + day_length_score, 3)

@api_view(['GET'])
def current_weather(request):
    # Get today's date
    today = datetime.now().date()
    
    # Get all cities with their latest weather data
    cities = City.objects.all()
    result = []
    
    for city in cities:
        # Get daily data for this city
        daily_data = DailyData.objects.filter(city=city).order_by('date')
        
        if not daily_data.exists():
            continue
            
        # Get the latest date's data
        latest_data = daily_data.latest('date')
        
        # Calculate sunny days for next 16 and 30 days
        future_data = daily_data.filter(date__gte=today)
        sunny_next_16 = future_data.filter(
            date__lt=today + timedelta(days=16),
            weathercode__in=[0, 1, 2]  # Clear or partly cloudy
        ).count()
        sunny_next_30 = future_data.filter(
            date__lt=today + timedelta(days=30),
            weathercode__in=[0, 1, 2]  # Clear or partly cloudy
        ).count()
        
        # Calculate day length in hours
        sunrise = latest_data.sunrise
        sunset = latest_data.sunset
        day_length = (
            sunset.hour * 60 + sunset.minute -
            (sunrise.hour * 60 + sunrise.minute)
        ) / 60.0
        
        # Calculate average temperature
        avg_temp = (latest_data.tmax_c + latest_data.tmin_c) / 2
        
        # Calculate niceness score (0-10)
        temp_score = max(0, 10 - abs(avg_temp - 22))  # Optimal temp is 22¬∞C (72¬∞F)
        sunny_score = min(10, sunny_next_16 / 1.6)  # Scale 0-16 to 0-10
        day_length_score = max(0, min(10, (day_length - 8) * 0.625))  # Scale 8-24 to 0-10
        niceness = round((temp_score + sunny_score + day_length_score) / 3, 1)
        
        result.append({
            'city': city.name,
            'niceness': niceness,
            'temp_high_f': round(latest_data.tmax_c * 9/5 + 32, 1),
            'temp_low_f': round(latest_data.tmin_c * 9/5 + 32, 1),
            'temp_f': round(avg_temp * 9/5 + 32, 1),
            'sunny_next_16': sunny_next_16,
            'sunny_next_30': sunny_next_30,
            'day_length': round(day_length, 1)
        })
    
    # Sort by niceness score descending
    result.sort(key=lambda x: x['niceness'], reverse=True)
    
    return JsonResponse({'cities': result})

       ====================
    üìÅ migrations/
      üìÑ __init__.py (0 bytes)
         Modified: 2025-01-04 17:42:46
         Content:
         ====================

         ====================
      üìÑ 0001_initial.py (1863 bytes)
         Modified: 2025-01-04 18:02:50
         Content:
         ====================
# Generated by Django 5.1.4 on 2025-01-04 23:02

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="City",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("name", models.CharField(max_length=100)),
                ("country", models.CharField(max_length=100)),
                ("latitude", models.FloatField()),
                ("longitude", models.FloatField()),
            ],
        ),
        migrations.CreateModel(
            name="DailyData",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("date", models.DateField()),
                ("tmax_c", models.FloatField()),
                ("tmin_c", models.FloatField()),
                ("weathercode", models.IntegerField()),
                ("sunrise", models.DateTimeField()),
                ("sunset", models.DateTimeField()),
                (
                    "city",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="daily_data",
                        to="weather_app.city",
                    ),
                ),
            ],
        ),
    ]

         ====================
      üìÑ 0002_alter_city_country_alter_dailydata_sunrise_and_more.py (678 bytes)
         Modified: 2025-01-04 23:06:30
         Content:
         ====================
# Generated by Django 5.1.4 on 2025-01-05 04:06

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("weather_app", "0001_initial"),
    ]

    operations = [
        migrations.AlterField(
            model_name="city",
            name="country",
            field=models.CharField(blank=True, max_length=100),
        ),
        migrations.AlterField(
            model_name="dailydata",
            name="sunrise",
            field=models.TimeField(),
        ),
        migrations.AlterField(
            model_name="dailydata",
            name="sunset",
            field=models.TimeField(),
        ),
    ]

         ====================
      üìÅ __pycache__/
        üìÑ 0001_initial.cpython-311.pyc (2032 bytes)
           Modified: 2025-01-04 18:02:56
        üìÑ 0002_alter_city_country_alter_dailydata_sunrise_and_more.cpython-311.pyc (1125 bytes)
           Modified: 2025-01-04 23:06:37
        üìÑ __init__.cpython-311.pyc (193 bytes)
           Modified: 2025-01-04 17:46:26
    üìÅ management/
      üìÑ .DS_Store (6148 bytes)
         Modified: 2025-01-04 21:09:50
      üìÑ __init__.py (1 bytes)
         Modified: 2025-01-04 22:02:45
         Content:
         ====================
 
         ====================
      üìÅ __pycache__/
        üìÑ __init__.cpython-311.pyc (193 bytes)
           Modified: 2025-01-04 22:02:52
      üìÅ commands/
        üìÑ .DS_Store (6148 bytes)
           Modified: 2025-01-04 21:09:50
        üìÑ import_old_data.py (3968 bytes)
           Modified: 2025-01-04 22:08:13
           Content:
           ====================
from django.core.management.base import BaseCommand
from weather_app.models import City, DailyData
import sqlite3
import os

class Command(BaseCommand):
    help = "Import data from old weather_data.db into Django models"

    def handle(self, *args, **options):
        # 1. Locate your old DB file
        old_db_path = os.path.join(os.getcwd(), 'weather_data.db')
        if not os.path.exists(old_db_path):
            self.stdout.write(self.style.ERROR(
                f"Could not find old DB at {old_db_path}!"
            ))
            return

        # 2. Connect to the old SQLite DB
        conn = sqlite3.connect(old_db_path)
        c = conn.cursor()

        # 3. Get city data from city_coords table
        # Note: city_coords doesn't have country, so we'll use a default
        c.execute("SELECT city, lat, lon FROM city_coords")
        rows_city = c.fetchall()

        city_lookup = {}
        for row in rows_city:
            city_name, lat, lon = row
            
            # Create or get the city in new DB
            # Using 'Unknown' as default country since it's not in the old DB
            city_obj, created = City.objects.get_or_create(
                name=city_name,
                defaults={
                    'country': 'Unknown',
                    'latitude': lat,
                    'longitude': lon
                }
            )
            # Store reference for later
            city_lookup[city_name] = city_obj

        self.stdout.write(self.style.SUCCESS(
            f"Imported/linked {len(city_lookup)} cities."
        ))

        # 4. Import daily data
        # Note: Added sunshine_duration_sec to match your schema
        c.execute("""
            SELECT city, date, tmax_c, tmin_c, weathercode, 
                   sunrise, sunset, sunshine_duration_sec 
            FROM daily_data
        """)
        rows_daily = c.fetchall()
        
        created_count = 0
        for row in rows_daily:
            (city_name, date_str, tmax_c, tmin_c, wcode, 
             sunrise_str, sunset_str, sunshine_duration) = row
            
            try:
                # Convert strings to date/datetime
                import datetime
                date_obj = datetime.datetime.strptime(date_str, "%Y-%m-%d").date()
                
                # Your sunrise/sunset times might need different parsing depending on format
                # Assuming they're in HH:MM format, we'll combine with the date
                sunrise_time = datetime.datetime.strptime(sunrise_str, "%H:%M").time()
                sunset_time = datetime.datetime.strptime(sunset_str, "%H:%M").time()
                
                sunrise_dt = datetime.datetime.combine(date_obj, sunrise_time)
                sunset_dt = datetime.datetime.combine(date_obj, sunset_time)

                # Get the city from the lookup
                city_obj = city_lookup.get(city_name)
                if city_obj is None:
                    self.stdout.write(self.style.WARNING(
                        f"Skipping data for unknown city: {city_name}"
                    ))
                    continue

                # Create new DailyData in Django
                DailyData.objects.create(
                    city=city_obj,
                    date=date_obj,
                    tmax_c=tmax_c,
                    tmin_c=tmin_c,
                    weathercode=wcode,
                    sunrise=sunrise_dt,
                    sunset=sunset_dt
                )
                created_count += 1
                
            except (ValueError, TypeError) as e:
                self.stdout.write(self.style.WARNING(
                    f"Error processing row for {city_name} on {date_str}: {str(e)}"
                ))
                continue

        self.stdout.write(self.style.SUCCESS(
            f"Imported {created_count} daily records from old DB!"
        ))

        # 5. Close old DB connection
        conn.close() 
           ====================
        üìÑ __init__.py (1 bytes)
           Modified: 2025-01-04 22:02:45
           Content:
           ====================
 
           ====================
        üìÑ import_weather_data.py (5819 bytes)
           Modified: 2025-01-04 22:50:32
           Content:
           ====================
import sqlite3
from datetime import datetime
from django.core.management.base import BaseCommand
from weather_app.models import City, DailyData
from django.db import transaction, IntegrityError
from django.utils.timezone import make_aware

# Same cities as wetha9.py
CITY_COUNTRY = {
    "Honolulu": "USA",
    "Todos Santos": "Mexico",
    "Tenerife": "Spain",
    "Los Angeles": "USA",
    "Medellin": "Colombia",
    "Mexico City": "Mexico",
    "Rio de Janeiro": "Brazil",
    "Fortaleza": "Brazil",
    "Abu Dhabi": "UAE",
    "Las Vegas": "USA",
    "Tucson": "USA",
    "Buenos Aires": "Argentina",
    "Sydney": "Australia",
    "Sao Paolo": "Brazil",
    "Berlin": "Germany",
    "Copenhagen": "Denmark",
    "Santa Fe": "USA",
    "Amsterdam": "Netherlands",
    "New York": "USA",
    "London": "UK",
    "Tokyo": "Japan",
    "Barcelona": "Spain",
    "Athens": "Greece",
    "Valencia": "Spain",
    "Shanghai": "China",
    "Austin": "USA",
    "Milos": "Greece",
    "Santiago": "Chile",
    "Lisbon": "Portugal",
    "El Paso": "USA",
    "Palm Springs": "USA"
}

class Command(BaseCommand):
    help = 'Import data from weather_data.db into Django database'

    def handle(self, *args, **options):
        # Connect to the old database
        conn = sqlite3.connect('../weather_data.db')
        cursor = conn.cursor()

        # Import only the cities we want
        total_cities = 0
        self.stdout.write('Importing cities...')
        
        with transaction.atomic():
            for city_name, country in CITY_COUNTRY.items():
                try:
                    # Get coordinates for the city
                    cursor.execute('SELECT lat, lon FROM city_coords WHERE city = ?', (city_name,))
                    coords = cursor.fetchone()
                    if coords:
                        lat, lon = coords
                    else:
                        lat, lon = 0, 0  # Default coordinates if not found
                    
                    city, created = City.objects.get_or_create(
                        name=city_name,
                        defaults={
                            'country': country,
                            'latitude': lat,
                            'longitude': lon
                        }
                    )
                    if created:
                        total_cities += 1
                except Exception as e:
                    self.stdout.write(self.style.ERROR(f'Error creating city {city_name}: {str(e)}'))

        self.stdout.write(self.style.SUCCESS(f'Created {total_cities} new cities'))

        # Import daily data for these cities
        success_count = 0
        error_count = 0
        
        self.stdout.write('Importing daily data...')
        
        with transaction.atomic():
            for city_name in CITY_COUNTRY.keys():
                try:
                    # Get all daily data for this city
                    cursor.execute('''
                        SELECT city, date, tmax_c, tmin_c, weathercode, sunrise, sunset 
                        FROM daily_data 
                        WHERE city = ?
                        ORDER BY date DESC
                    ''', (city_name,))
                    
                    daily_data = cursor.fetchall()
                    city = City.objects.get(name=city_name)
                    
                    for row in daily_data:
                        try:
                            city_name, date, tmax_c, tmin_c, weathercode, sunrise, sunset = row
                            date_obj = datetime.strptime(date, '%Y-%m-%d').date()
                            
                            # Parse datetime strings that include the date
                            try:
                                sunrise_obj = make_aware(datetime.strptime(sunrise, '%Y-%m-%dT%H:%M:%S'))
                            except:
                                sunrise_obj = make_aware(datetime.strptime(f"{date} 06:00:00", '%Y-%m-%d %H:%M:%S'))
                                
                            try:
                                sunset_obj = make_aware(datetime.strptime(sunset, '%Y-%m-%dT%H:%M:%S'))
                            except:
                                sunset_obj = make_aware(datetime.strptime(f"{date} 18:00:00", '%Y-%m-%d %H:%M:%S'))
                            
                            # Skip records with missing temperature data
                            if tmax_c is None or tmin_c is None:
                                continue
                            
                            # Create or update the daily data record
                            daily_data_obj, created = DailyData.objects.update_or_create(
                                city=city,
                                date=date_obj,
                                defaults={
                                    'tmax_c': float(tmax_c),
                                    'tmin_c': float(tmin_c),
                                    'weathercode': int(weathercode) if weathercode is not None else 0,
                                    'sunrise': sunrise_obj,
                                    'sunset': sunset_obj
                                }
                            )
                            success_count += 1
                        except Exception as e:
                            error_count += 1
                            self.stdout.write(self.style.ERROR(f'Error importing data for {city_name} on {date}: {str(e)}'))
                except Exception as e:
                    self.stdout.write(self.style.ERROR(f'Error processing city {city_name}: {str(e)}'))

        conn.close()
        self.stdout.write(self.style.SUCCESS(f'Import completed. Successes: {success_count}, Errors: {error_count}')) 
           ====================
        üìÑ fetch_weather.py (5028 bytes)
           Modified: 2025-01-04 23:07:00
           Content:
           ====================
import os
import requests
from datetime import datetime, timedelta, time
from django.core.management.base import BaseCommand
from weather_app.models import City, DailyData

CITY_COORDS = {
    'Honolulu': (21.3069, -157.8583),
    'San Diego': (32.7157, -117.1611),
    'Miami': (25.7617, -80.1918),
    'Phoenix': (33.4484, -112.0740),
    'Austin': (30.2672, -97.7431),
    'Las Vegas': (36.1699, -115.1398),
    'Los Angeles': (34.0522, -118.2437),
    'San Jose': (37.3382, -121.8863),
    'San Francisco': (37.7749, -122.4194),
    'Sacramento': (38.5816, -121.4944),
    'Portland': (45.5155, -122.6789),
    'Seattle': (47.6062, -122.3321),
    'Denver': (39.7392, -104.9903),
    'Dallas': (32.7767, -96.7970),
    'Houston': (29.7604, -95.3698),
    'Chicago': (41.8781, -87.6298),
    'Minneapolis': (44.9778, -93.2650),
    'Nashville': (36.1627, -86.7816),
    'Atlanta': (33.7490, -84.3880),
    'Washington': (38.9072, -77.0369),
    'Philadelphia': (39.9526, -75.1652),
    'New York': (40.7128, -74.0060),
    'Boston': (42.3601, -71.0589),
    'Abu Dhabi': (24.4539, 54.3773),
    'Dubai': (25.2048, 55.2708),
    'Bangkok': (13.7563, 100.5018),
    'Singapore': (1.3521, 103.8198),
    'Tokyo': (35.6762, 139.6503),
    'Sydney': (-33.8688, 151.2093),
    'Auckland': (-36.8509, 174.7645),
    'London': (51.5074, -0.1278)
}

class Command(BaseCommand):
    help = 'Fetches current weather data for hardcoded cities'

    def handle(self, *args, **options):
        # Get today's date and the next 5 days (within API limits)
        today = datetime.now().date()
        end_date = min(today + timedelta(days=5), datetime(2025, 1, 5).date())

        for city_name, coords in CITY_COORDS.items():
            try:
                # Get or create city with coordinates
                city, created = City.objects.update_or_create(
                    name=city_name,
                    defaults={
                        'latitude': coords[0],
                        'longitude': coords[1]
                    }
                )
                
                # Fetch weather data from Open-Meteo API
                url = "https://api.open-meteo.com/v1/forecast"  # Using forecast API instead of historical
                params = {
                    "latitude": coords[0],
                    "longitude": coords[1],
                    "daily": "temperature_2m_max,temperature_2m_min,weathercode,sunrise,sunset",
                    "timezone": "UTC",
                    "forecast_days": 16  # Get maximum forecast days
                }
                
                response = requests.get(url, params=params)
                data = response.json()

                if "daily" in data:
                    daily_data = data["daily"]
                    dates = daily_data["time"]
                    for i in range(len(dates)):
                        date = datetime.strptime(dates[i], "%Y-%m-%d").date()
                        
                        # Convert weather codes to match our format
                        weather_code = daily_data["weathercode"][i]
                        if weather_code in [0]:  # Clear sky
                            weather_code = 0
                        elif weather_code in [1, 2]:  # Few/scattered clouds
                            weather_code = 1
                        elif weather_code in [3]:  # Broken/overcast clouds
                            weather_code = 2
                        else:  # All other conditions
                            weather_code = 3

                        # Parse sunrise and sunset times
                        sunrise_str = daily_data["sunrise"][i].split("T")[1]
                        sunset_str = daily_data["sunset"][i].split("T")[1]
                        sunrise_time = time.fromisoformat(sunrise_str)
                        sunset_time = time.fromisoformat(sunset_str)

                        # Create or update daily data
                        daily_data_obj, created = DailyData.objects.update_or_create(
                            city=city,
                            date=date,
                            defaults={
                                'tmax_c': daily_data["temperature_2m_max"][i],
                                'tmin_c': daily_data["temperature_2m_min"][i],
                                'weathercode': weather_code,
                                'sunrise': sunrise_time,
                                'sunset': sunset_time
                            }
                        )

                    self.stdout.write(self.style.SUCCESS(f'Successfully updated weather data for {city_name}'))
                else:
                    self.stdout.write(self.style.WARNING(f'Failed to fetch data for {city_name}: {data.get("reason", "Unknown error")}'))

            except Exception as e:
                self.stdout.write(self.style.ERROR(f'Error processing {city_name}: {str(e)}'))

        self.stdout.write(self.style.SUCCESS('Weather data update completed')) 
           ====================
        üìÑ check_data.py (640 bytes)
           Modified: 2025-01-04 22:06:06
           Content:
           ====================
from django.core.management.base import BaseCommand
from weather_app.models import City, DailyData

class Command(BaseCommand):
    help = 'Check database contents'

    def handle(self, *args, **options):
        city_count = City.objects.count()
        daily_data_count = DailyData.objects.count()
        
        self.stdout.write(f'Number of cities: {city_count}')
        self.stdout.write(f'Number of daily data records: {daily_data_count}')
        
        if daily_data_count > 0:
            latest = DailyData.objects.order_by('-date').first()
            self.stdout.write(f'Latest data: {latest.city.name} on {latest.date}') 
           ====================
        üìÅ __pycache__/
          üìÑ import_old_data.cpython-311.pyc (4746 bytes)
             Modified: 2025-01-04 18:08:42
          üìÑ import_weather_data.cpython-311.pyc (7202 bytes)
             Modified: 2025-01-04 22:50:46
          üìÑ check_data.cpython-311.pyc (1651 bytes)
             Modified: 2025-01-04 22:06:51
          üìÑ fetch_weather.cpython-311.pyc (5993 bytes)
             Modified: 2025-01-04 23:07:05
          üìÑ __init__.cpython-311.pyc (202 bytes)
             Modified: 2025-01-04 22:02:52
    üìÅ __pycache__/
      üìÑ views.cpython-311.pyc (5930 bytes)
         Modified: 2025-01-04 23:08:12
      üìÑ urls.cpython-311.pyc (974 bytes)
         Modified: 2025-01-04 22:06:08
      üìÑ models.cpython-311.pyc (1879 bytes)
         Modified: 2025-01-04 23:06:30
      üìÑ serializers.cpython-311.pyc (1268 bytes)
         Modified: 2025-01-04 19:30:08
      üìÑ admin.cpython-311.pyc (237 bytes)
         Modified: 2025-01-04 17:46:26
      üìÑ apps.cpython-311.pyc (1979 bytes)
         Modified: 2025-01-04 23:05:11
      üìÑ __init__.cpython-311.pyc (182 bytes)
         Modified: 2025-01-04 17:46:26
    üìÅ templates/
      üìÑ index.html (12629 bytes)
         Modified: 2025-01-04 22:52:18
         Content:
         ====================
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Weather Frontend (PyQt -> Web)</title>
  <style>
    /* Basic styling for tab links and content sections */
    .tab-links {
      margin-bottom: 1em;
    }
    .tab-links button {
      margin-right: 10px;
    }
    .tab-content {
      display: none; /* hidden by default */
    }
    .tab-content.active {
      display: block; /* show the active tab */
    }
    table, th, td {
      border: 1px solid #ccc;
      border-collapse: collapse;
      padding: 5px;
    }

    /* highlight classes, similar to PyQt's highlight_cell logic */
    .highlight-hot {
      background-color: red; color: white;
    }
    .highlight-cold {
      background-color: blue; color: white;
    }
    .highlight-nice-strict {
      background-color: yellow;
    }
    .highlight-nice-light {
      background-color: #ffffe0;
    }
  </style>
</head>
<body>
  <h1>Weather App (Replicating PyQt GUI in Web)</h1>
  <div class="tab-links">
    <button onclick="showTab('current')">Current Weather</button>
    <button onclick="showTab('monthly')">Monthly Calendar</button>
    <button onclick="showTab('detail')">City Detail</button>
    <button onclick="showTab('itinerary')">Itinerary</button>
  </div>

  <!-- Current Weather Tab -->
  <div class="tab-content" id="tab-current">
    <h2>Current Weather</h2>
    <button onclick="loadCurrentData()">Load Current Data</button>
    <table id="currentTable">
      <thead>
        <tr>
          <th>Niceness</th>
          <th>City</th>
          <th>Temp High (F)</th>
          <th>Temp Avg (F)</th>
          <th>Temp Low (F)</th>
          <th>Sunny Next 16</th>
          <th>Sunny Next 30</th>
          <th>Day Length</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Monthly Calendar Tab -->
  <div class="tab-content" id="tab-monthly">
    <h2>Monthly Data</h2>
    <button onclick="loadMonthlyData()">Load Monthly Data</button>
    <div id="monthlyResults"></div>
  </div>

  <!-- City Detail Tab -->
  <div class="tab-content" id="tab-detail">
    <h2>City Detail</h2>
    <p>Enter a city name:</p>
    <input type="text" id="detailCityName" placeholder="e.g. 'New York'"/>
    <button onclick="loadCityDetail()">Load Detail</button>
    <div id="cityDetailResults"></div>
  </div>

  <!-- Itinerary Tab -->
  <div class="tab-content" id="tab-itinerary">
    <h2>Itinerary (Top Niceness per Month)</h2>
    <button onclick="loadItinerary()">Load Itinerary</button>
    <div id="itineraryResults"></div>
  </div>

<script>
  // Basic tab switching
  function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(div => {
      div.classList.remove('active');
    });
    document.getElementById('tab-' + tabName).classList.add('active');
  }
  // Show the first tab by default
  showTab('current');

  // logic from your "highlight_cell" approach:
  function highlightCell(td, avg_temp, sunny_days, day_length) {
    // clear existing highlight classes
    td.classList.remove('highlight-hot','highlight-cold','highlight-nice-strict','highlight-nice-light');

    if(avg_temp === null || isNaN(avg_temp) || 
       sunny_days === null || isNaN(sunny_days) || 
       day_length === null || isNaN(day_length)) {
      return;
    }
    if(avg_temp > 90) {
      td.classList.add('highlight-hot');
    } else if(avg_temp < 50) {
      td.classList.add('highlight-cold');
    } else if(isNiceStrict(avg_temp, sunny_days, day_length)) {
      td.classList.add('highlight-nice-strict');
    } else if(isNiceLight(avg_temp, sunny_days, day_length)) {
      td.classList.add('highlight-nice-light');
    }
  }
  function isNiceStrict(avg_temp, sunny_days, day_length) {
    return (avg_temp > 70) && (sunny_days > 12) && (day_length > 10);
  }
  function isNiceLight(avg_temp, sunny_days, day_length) {
    return (avg_temp > 60) && (sunny_days > 10) && (day_length > 10);
  }

  // ------------- Current Weather -------------
  function loadCurrentData() {
    fetch('/api/current/')
      .then(resp => resp.json())
      .then(data => {
        const tbody = document.querySelector('#currentTable tbody');
        tbody.innerHTML = '';
        data.weather.forEach(row => {
          const tr = document.createElement('tr');
          
          // Niceness Score
          const nicenessTd = document.createElement('td');
          nicenessTd.textContent = row.niceness;
          if (row.niceness >= 80) {
            nicenessTd.classList.add('highlight-nice-strict');
          } else if (row.niceness >= 60) {
            nicenessTd.classList.add('highlight-nice-light');
          }
          tr.appendChild(nicenessTd);

          // City
          const cityTd = document.createElement('td');
          cityTd.textContent = row.city;
          tr.appendChild(cityTd);

          // Temp High
          const highTd = document.createElement('td');
          highTd.textContent = row.temp_high;
          tr.appendChild(highTd);

          // Temp Avg
          const avgTd = document.createElement('td');
          avgTd.textContent = row.temp_avg;
          tr.appendChild(avgTd);

          // Temp Low
          const lowTd = document.createElement('td');
          lowTd.textContent = row.temp_low;
          tr.appendChild(lowTd);

          // Sunny Next 16
          const sunny16Td = document.createElement('td');
          sunny16Td.textContent = row.sunny_days_16;
          tr.appendChild(sunny16Td);

          // Sunny Next 30
          const sunny30Td = document.createElement('td');
          sunny30Td.textContent = row.sunny_days_30;
          tr.appendChild(sunny30Td);

          // Day Length
          const dlTd = document.createElement('td');
          dlTd.textContent = row.day_length;
          tr.appendChild(dlTd);

          // highlight the temperature cells based on the values
          if (row.temp_avg > 90) {
            highTd.classList.add('highlight-hot');
            avgTd.classList.add('highlight-hot');
            lowTd.classList.add('highlight-hot');
          } else if (row.temp_avg < 50) {
            highTd.classList.add('highlight-cold');
            avgTd.classList.add('highlight-cold');
            lowTd.classList.add('highlight-cold');
          } else if (row.niceness >= 80) {
            highTd.classList.add('highlight-nice-strict');
            avgTd.classList.add('highlight-nice-strict');
            lowTd.classList.add('highlight-nice-strict');
          } else if (row.niceness >= 60) {
            highTd.classList.add('highlight-nice-light');
            avgTd.classList.add('highlight-nice-light');
            lowTd.classList.add('highlight-nice-light');
          }

          tbody.appendChild(tr);
        });
      })
      .catch(err => console.error('Error loading current data:', err));
  }

  // ------------- Monthly Data -------------
  function loadMonthlyData() {
    fetch('/api/monthly/')
      .then(resp => resp.json())
      .then(data => {
        // data = [ {city, country, monthly:[ {month, tmax_f, tmin_f, avg_temp_f, niceness}, ... ]}, ...]
        const container = document.getElementById('monthlyResults');
        container.innerHTML = '';

        data.forEach(cityEntry => {
          const cityName = cityEntry.city;
          const country = cityEntry.country;
          const monthlyArr = cityEntry.monthly;

          const cityHeader = document.createElement('h3');
          cityHeader.textContent = ${cityName} (${country});
          container.appendChild(cityHeader);

          const table = document.createElement('table');
          const thead = document.createElement('thead');
          thead.innerHTML = <tr>
            <th>Month</th>
            <th>Tmax (F)</th>
            <th>Tmin (F)</th>
            <th>Avg Temp (F)</th>
            <th>Niceness</th>
          </tr>;
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          monthlyArr.forEach(m => {
            const tr = document.createElement('tr');
            const monthTd = document.createElement('td'); monthTd.textContent = m.month;
            tr.appendChild(monthTd);

            const tmaxTd = document.createElement('td'); tmaxTd.textContent = m.tmax_f ?? 'N/A';
            tr.appendChild(tmaxTd);

            const tminTd = document.createElement('td'); tminTd.textContent = m.tmin_f ?? 'N/A';
            tr.appendChild(tminTd);

            const avgTd = document.createElement('td'); avgTd.textContent = m.avg_temp_f ?? 'N/A';
            tr.appendChild(avgTd);

            const nicenessTd = document.createElement('td'); nicenessTd.textContent = m.niceness ?? 'N/A';
            tr.appendChild(nicenessTd);

            // highlight the avg temp cell:
            highlightCell(avgTd, m.avg_temp_f, m.sunny_days, m.day_length);

            tbody.appendChild(tr);
          });
          table.appendChild(tbody);
          container.appendChild(table);
        });
      })
      .catch(err => console.error('Error loading monthly data:', err));
  }

  // ------------- City Detail -------------
  function loadCityDetail() {
    const cityName = document.getElementById('detailCityName').value.trim();
    if(!cityName) {
      alert("Please enter a city name.");
      return;
    }
    fetch(/api/city/${cityName}/)
      .then(resp => resp.json())
      .then(data => {
        if(data.error) {
          document.getElementById('cityDetailResults').innerHTML = <p style="color:red;">${data.error}</p>;
          return;
        }
        /*
          data = {
            city, country, latitude, longitude,
            daily_data: [ {date, tmax_f, tmin_f, weathercode, niceness}, ... ]
          }
        */
        const container = document.getElementById('cityDetailResults');
        container.innerHTML = '';

        const header = document.createElement('h3');
        header.textContent = ${data.city}, ${data.country} (Lat:${data.latitude}, Lon:${data.longitude});
        container.appendChild(header);

        const table = document.createElement('table');
        table.innerHTML = <thead>
          <tr>
            <th>Date</th>
            <th>Tmax (F)</th>
            <th>Tmin (F)</th>
            <th>WeatherCode</th>
            <th>Niceness</th>
          </tr>
        </thead>;
        const tbody = document.createElement('tbody');

        data.daily_data.forEach(rec => {
          const tr = document.createElement('tr');
          const dTd = document.createElement('td'); dTd.textContent = rec.date;
          tr.appendChild(dTd);

          const tmaxTd = document.createElement('td'); tmaxTd.textContent = rec.tmax_f ?? 'N/A';
          tr.appendChild(tmaxTd);

          const tminTd = document.createElement('td'); tminTd.textContent = rec.tmin_f ?? 'N/A';
          tr.appendChild(tminTd);

          const codeTd = document.createElement('td'); codeTd.textContent = rec.weathercode ?? 'N/A';
          tr.appendChild(codeTd);

          const nicenessTd = document.createElement('td'); nicenessTd.textContent = rec.niceness ?? 'N/A';
          tr.appendChild(nicenessTd);

          // highlight row or tmax cell if desired:
          highlightCell(tmaxTd, rec.tmax_f, 15, 12); // or real sunnyDays/dayLength

          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        container.appendChild(table);
      })
      .catch(err => {
        console.error('Error loading city detail:', err);
      });
  }

  // ------------- Itinerary -------------
  function loadItinerary() {
    fetch('/api/itinerary/')
      .then(resp => resp.json())
      .then(data => {
        /*
          data = {
            "1": [("CityX", 0.85), ("CityY", 0.81), ...],   # top cities for month=1
            "2": [...],
            ...
          }
        */
        const container = document.getElementById('itineraryResults');
        container.innerHTML = '<p>Top 5 Niceness per Month:</p>';

        for(let month in data) {
          const cityList = data[month]; // array of [cityName, nicenessVal]
          const div = document.createElement('div');
          div.innerHTML = <h4>Month: ${month}</h4>;
          const ul = document.createElement('ul');
          cityList.forEach(entry => {
            const li = document.createElement('li');
            li.textContent = ${entry[0]} (Niceness = ${entry[1]});
            ul.appendChild(li);
          });
          div.appendChild(ul);
          container.appendChild(div);
        }
      })
      .catch(err => console.error('Error loading itinerary:', err));
  }
</script>

</body>
</html> 
         ====================